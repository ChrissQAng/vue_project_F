const express = require("express");
const app = express();
const port = 3000;

// Sample data
const defaultData = [
  {
    channel: 1,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 112,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 230,
    yfm: 1536,
    ychart: [
      530, 532, 510, 520, 574, 630, 636, 650, 669, 662, 672, 669, 675, 677, 672,
      684, 673, 684, 678, 676, 675, 679, 678, 680, 654, 628, 609, 595, 596, 576,
      598, 599, 592, 588, 573, 574, 580, 584, 580, 572, 562, 574, 561, 558,
    ],
  },
  {
    channel: 2,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 118,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 150,
    yfm: 1483,
    ychart: [
      538, 528, 510, 532, 692, 822, 854, 885, 908, 914, 915, 921, 922, 918, 918,
      936, 918, 928, 922, 920, 927, 922, 930, 916, 867, 807, 754, 741, 742, 732,
      724, 706, 682, 684, 684, 680, 676, 690, 670, 660, 652, 642, 637, 636,
    ],
  },
  {
    channel: 3,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 187,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 182,
    yfm: 924,
    ychart: [
      530, 532, 510, 520, 574, 630, 636, 650, 669, 662, 672, 669, 675, 677, 672,
      684, 673, 684, 678, 676, 675, 679, 678, 680, 654, 628, 609, 595, 596, 576,
      598, 599, 592, 588, 573, 574, 580, 584, 580, 572, 562, 574, 561, 558,
    ],
  },
  {
    channel: 4,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 187,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 182,
    yfm: 924,
    ychart: [
      538, 528, 510, 532, 692, 822, 854, 885, 908, 914, 915, 921, 922, 918, 918,
      936, 918, 928, 922, 920, 927, 922, 930, 916, 867, 807, 754, 741, 742, 732,
      724, 706, 682, 684, 684, 680, 676, 690, 670, 660, 652, 642, 637, 636,
    ],
  },
  {
    channel: 5,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 187,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 182,
    yfm: 924,
    ychart: [
      530, 532, 510, 520, 574, 630, 636, 650, 669, 662, 672, 669, 675, 677, 672,
      684, 673, 684, 678, 676, 675, 679, 678, 680, 654, 628, 609, 595, 596, 576,
      598, 599, 592, 588, 573, 574, 580, 584, 580, 572, 562, 574, 561, 558,
    ],
  },
  {
    channel: 6,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 187,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 182,
    yfm: 924,
    ychart: [
      538, 528, 510, 532, 692, 822, 854, 885, 908, 914, 915, 921, 922, 918, 918,
      936, 918, 928, 922, 920, 927, 922, 930, 916, 867, 807, 754, 741, 742, 732,
      724, 706, 682, 684, 684, 680, 676, 690, 670, 660, 652, 642, 637, 636,
    ],
  },
  {
    channel: 7,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 187,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 182,
    yfm: 924,
    ychart: [
      530, 532, 510, 520, 574, 630, 636, 650, 669, 662, 672, 669, 675, 677, 672,
      684, 673, 684, 678, 676, 675, 679, 678, 680, 654, 628, 609, 595, 596, 576,
      598, 599, 592, 588, 573, 574, 580, 584, 580, 572, 562, 574, 561, 558,
    ],
  },
  {
    channel: 8,
    ftime: new Date(2025, 1, 19, 22, 0, 0),
    f: 187,
    ytime: new Date(2025, 1, 19, 0, 0, 0),
    yf: 182,
    yfm: 924,
    ychart: [
      538, 528, 510, 532, 692, 822, 854, 885, 908, 914, 915, 921, 922, 918, 918,
      936, 918, 928, 922, 920, 927, 922, 930, 916, 867, 807, 754, 741, 742, 732,
      724, 706, 682, 684, 684, 680, 676, 690, 670, 660, 652, 642, 637, 636,
    ],
  },
];
const dataCh1 = [
  { channel: 1, ft: 123 },
  { channel: 2, ft: 234 },
];
function delay(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
// Route to handle /data with optional query parameter
app.get("/data", (req, res) => {
  res.type("application/json");
  res.set("Access-Control-Allow-Origin", "*");
  if (req.query.ch === "1,2") {
    let d = dataCh1;
    d[0].ft = Math.floor(Math.random() * 1000);
    d[1].ft = Math.floor(Math.random() * 1000);
    res.json(d);
  } else {
    res.json(defaultData);
  }
});

app.get("/set", async (req, res) => {
  if ("meas" in req.query) {
    await delay(5000);
  }
  res.type("application/json");
  res.set("Access-Control-Allow-Origin", "*");
  res.json([]);
});

app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`);
});
